<!DOCTYPE html>



<html lang="en">
<head>

    


    


<title>
    Persistence
</title>
<meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">



<link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,700,300,400" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="http://seedstack.org/assets/unify/css/style.css">
<link rel="stylesheet" href="http://seedstack.org/assets/unify/plugins/font-awesome/css/font-awesome.css">
<link rel="stylesheet" href="http://seedstack.org/css/style.css">



<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "url": "http://seedstack.org",
  "logo": "http://seedstack.org/img/logos/seedstack.png"
}
</script>



<meta property="og:title" content='Persistence' />
<meta property="og:description" content="Now that we have a domain model, we would like to use some persistence with it. In Domain-Driven Design, persistence is done with Repositories which work on whole aggregates.
We need some data first! To be able to test this, we need some sample data. A class implementing LifecycleListener will provide the opportunity to insert data at application startup.
In the package infrastructure, create a SampleDataGenerator class:
package org.generated.project.infrastructure; import javax." />
<meta property="og:url" content="http://seedstack.org/docs/basics/persistence/" />
<meta property="og:site_name" content="SeedStack" />
<meta property="og:image" content="http://seedstack.org/img/opengraph.png" />



<link rel="search" type="application/opensearchdescription+xml" href="http://seedstack.org/opensearch.xml" title="SeedStack" />



<link rel="apple-touch-icon" sizes="57x57" href="http://seedstack.org/img/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="http://seedstack.org/img/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://seedstack.org/img/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="http://seedstack.org/img/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="http://seedstack.org/img/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="http://seedstack.org/img/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="http://seedstack.org/img/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="http://seedstack.org/img/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="http://seedstack.org/img/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="http://seedstack.org/img/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="http://seedstack.org/img/favicons/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="http://seedstack.org/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="http://seedstack.org/img/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="http://seedstack.org/img/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="http://seedstack.org/img/favicons/manifest.json">
<meta name="apple-mobile-web-app-title" content="SeedStack">
<meta name="application-name" content="SeedStack">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/img/favicons/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">



<script type="text/javascript">
    window.seedstack = {
        baseUrl: "http:\/\/seedstack.org\/",
        state: {}
    };
</script>


</head>
<body class="homepage">
    
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5R5FP9"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5R5FP9');</script>


    <div id="header">
        
    

<div class="header">
    <div class="container">
        <a class="logo" href="http://seedstack.org/">SeedStack</a>
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="fa fa-bars"></span>
        </button>
    </div>
    <div class="collapse navbar-collapse navbar-responsive-collapse" data-role="navigation" style="pointer-events: none;">
        <div class="container">
            <ul class="nav navbar-nav" style="pointer-events: auto;">
                <li class='active'>
                    <a href="http://seedstack.org/docs">Documentation</a>
                </li>
                <li class=''>
                    <a href="http://seedstack.org/guides">Guides</a>
                </li>
                <li class=''>
                    <a href="http://seedstack.org/addons">Add-ons</a>
                </li>
                <li class=''>
                    <a href="http://seedstack.org/posts">News</a>
                </li>
                <li class=''>
                    <a href="http://seedstack.org/community">Community</a>
                </li>
                <li class='dropdown '>
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown">
                        More
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="http://seedstack.org/glossary">Glossary</a></li>
                        <li><a href="http://seedstack.org/tags">Tags</a></li>
                        <li><a href="http://seedstack.org/project">Project info</a></li>
                        <li><a target="_blank" href="http://seedstack.org/javadoc"><i style="margin-top: 3px" class="pull-right fa fa-external-link"></i> Javadoc</a></li>
                        <li><a target="_blank" href="https://github.com/seedstack/distribution/releases"><i style="margin-top: 3px" class="pull-right fa fa-external-link"></i> Releases</a></li>
                        <li><a target="_blank" href="https://github.com/seedstack"><i style="margin-top: 3px" class="pull-right fa fa-external-link"></i> GitHub</a></li>
                    </ul>
                </li>
                <li>
                    <i class="search fa fa-search search-btn"></i>
                    <div class="search-open">
                        <form method="GET" action="http://seedstack.org/search">
                            <div class="input-group animated fadeInDown">
                                <input id="search-field" type="text" class="form-control" placeholder="Search" name="q">
                                <span class="input-group-btn">
                                    <button class="btn-u" type="submit">Go</button>
                                </span>
                            </div>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>


        
    

<div class="title-header small">
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-12">
                <h1>Documentation</h1>
                <p class="hidden-xs">
                    Learn everything about SeedStack.
            </div>
            <div class="col-md-3 hidden-sm hidden-xs">
                <div class="header-image-wrapper">
                    <img class="header-image" src="/img/logos/glossary-logo.svg">
                </div>
            </div>
        </div>
    </div>
</div>
<div class="title-subheader">
    <div class="container">
        <ul>
            <li>
                <span class='active'>
                    <i class="fa fa-dot-circle-o"></i> <a href="http://seedstack.org/docs">Core</a>
                </span>
            </li>
            <li>
                <span class=''>
                    <i class="fa fa-briefcase"></i> <a href="http://seedstack.org/docs/business">Business</a>
                </span>
            </li>
            <li>
                <span class=''>
                    <i class="fa fa-cog"></i> <a href="http://seedstack.org/docs/maven-plugin">Maven plugin</a>
                </span>
            </li>
            <li>
                <span class=''>
                    <i class="fa fa-gift"></i> <a href="http://seedstack.org/docs/samples">Samples</a>
                </span>
            </li>
            <li>
                <span>
                    <i class="fa fa-medkit"></i> <a target="_blank" href="http://seedstack.org/docs/troubleshooting">Troubleshooting</a>
                </span>
            </li>
            <li>
                <span>
                    <i class="fa fa-coffee"></i> <a target="_blank" href="http://seedstack.org/javadoc">Javadoc</a>
                </span>
            </li>
            
            <li class="pull-right">
                <span class="menu-toggle" style="" data-toggle="collapse" data-target=".side-menu-collapse">
    <span class="sr-only">Toggle menu</span>
    <i class="fa fa-bars"></i>
</span>

            </li>
            
        </ul>
    </div>
</div>

    </div>
    <div id="content" class="container">
        <div class="row">
    
    <div class="col-md-3">
        












<nav class="side-menu collapse side-menu-collapse" data-role="navigation">
    <div class="list-group">
        <ul class="nav">
            
            
            <li class="list-group-header">
                <a href="/docs/basics/" class=" active" data-target=".the-basics">The Basics</a>
            </li>
            
            <li class="list-group-item">
                <ul>
                    
                    
                    <li>
                        
                        <a href="/docs/basics/" class="">
                            Getting Started
                        </a>
                        
                    </li>
                    
                    
                    
                        
                        <script>
                            seedstack.state.previousPage = '\/docs\/basics\/';
                        </script>
                    
                    
                    
                    <li>
                        
                        <a href="/docs/basics/learn-the-basics/" class="">
                            Learn the Basics
                        </a>
                        
                    </li>
                    
                    
                    
                        
                        <script>
                            seedstack.state.previousPage = '\/docs\/basics\/learn-the-basics\/';
                        </script>
                    
                    
                    
                    <li>
                        
                        <a href="/docs/basics/dependency-injection/" class="">
                            Dependency Injection
                        </a>
                        
                    </li>
                    
                    
                    
                        
                        <script>
                            seedstack.state.previousPage = '\/docs\/basics\/dependency-injection\/';
                        </script>
                    
                    
                    
                    <li>
                        
                        <a href="/docs/basics/business/" class="">
                            Business Code
                        </a>
                        
                    </li>
                    
                    
                    
                        
                        <script>
                            seedstack.state.previousPage = '\/docs\/basics\/business\/';
                        </script>
                    
                    
                    
                    <li>
                        
                        <a href="/docs/basics/persistence/" class="active">
                            Persistence
                        </a>
                        
                    </li>
                    
                    
                        
                        
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/basics/rest/" class="">
                            REST API
                        </a>
                        
                    </li>
                    
                        
                        
                        <script>
                            seedstack.state.nextPage = '\/docs\/basics\/rest\/';
                        </script>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/basics/testing/" class="">
                            Testing
                        </a>
                        
                    </li>
                    
                    
                    
                    
                </ul>
            </li>
            
            </li>
            
            <li class="list-group-header">
                <a href="/docs/core/" class="" data-target=".core">Core</a>
            </li>
            
            <li class="list-group-item">
                <ul>
                    
                    
                    <li>
                        
                        <a href="/docs/core/" class="">
                            Running Applications
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/testing/" class="">
                            Integration Testing
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/configuration/" class="">
                            Configuration
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/logging/" class="">
                            Logging
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/security/" class="">
                            Security
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/crypto/" class="">
                            Cryptography
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/transactions/" class="">
                            Transactions
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/validation/" class="">
                            Validation
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/jndi/" class="">
                            JNDI
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/core/proxy/" class="">
                            Proxy
                        </a>
                        
                    </li>
                    
                    
                    
                    
                </ul>
            </li>
            
            </li>
            
            <li class="list-group-header">
                <a href="/docs/cli/" class="" data-target=".command-line">Command-Line</a>
            </li>
            
            <li class="list-group-item">
                <ul>
                    
                    
                    <li>
                        
                        <a href="/docs/cli/" class="">
                            Running CLI Applications
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/cli/commands/" class="">
                            Defining Commands
                        </a>
                        
                    </li>
                    
                    
                    
                    
                </ul>
            </li>
            
            </li>
            
            <li class="list-group-header">
                <a href="/docs/web/" class="" data-target=".web">Web</a>
            </li>
            
            <li class="list-group-item">
                <ul>
                    
                    
                    <li>
                        
                        <a href="/docs/web/" class="">
                            Running Web Applications
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/testing/" class="">
                            Web Integration Testing
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/rest/" class="">
                            REST
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/cors/" class="">
                            CORS
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/security/" class="">
                            Web Security
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/servlets/" class="">
                            Servlet, Filters and Listeners
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/static-resources/" class="">
                            Static Resources
                        </a>
                        
                    </li>
                    
                    
                    
                    
                    
                    <li>
                        
                        <a href="/docs/web/websockets/" class="">
                            WebSockets
                        </a>
                        
                    </li>
                    
                    
                    
                    
                </ul>
            </li>
            
            </li>
            
        </ul>
    </div>
</nav>



    </div>
    <div class="col-md-9">
    
        <div class="content-wrapper">
            <div class="doc-content">
                <h1 class="nocount">Persistence</h1>
                

<p>Now that we have a domain model, we would like to use some persistence with it. In Domain-Driven Design, persistence is
done with <a href="http://seedstack.org/docs/business/repositories/">Repositories</a> which work on whole aggregates.</p>

<h2 id="we-need-some-data-first">We need some data first!</h2>

<p>To be able to test this, we need some sample data. A class implementing <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;seed.&amp;#8203;LifecycleListener' href='http://seedstack.org/javadoc/org/seedstack/seed/LifecycleListener.html'>LifecycleListener</a></code>
will provide the opportunity to insert data at application startup.</p>

<p>In the package <code>infrastructure</code>, create a <code>SampleDataGenerator</code> class:</p>

<pre><code class="language-java">package org.generated.project.infrastructure;

import javax.inject.Inject;
import org.generated.project.domain.model.person.Person;
import org.generated.project.domain.model.person.PersonId;
import org.seedstack.business.domain.Repository;
import org.seedstack.business.util.inmemory.InMemory;
import org.seedstack.seed.LifecycleListener;

public class SampleDataGenerator implements LifecycleListener {
    @Inject
    @InMemory
    private Repository&lt;Person, PersonId&gt; personRepository;

    @Override
    public void started() {
        personRepository.addOrUpdate(create(&quot;bill.evans@some.org&quot;, &quot;Bill&quot;, &quot;EVANS&quot;));
        personRepository.addOrUpdate(create(&quot;ella.fitzgerald@some.org&quot;, &quot;Ella&quot;, &quot;FITZGERALD&quot;));
        personRepository.addOrUpdate(create(&quot;miles.davis@some.org&quot;, &quot;Miles&quot;, &quot;DAVIS&quot;));
    }

    private Person create(String email, String firstName, String lastName) {
        Person person = new Person(new PersonId(email));
        person.changeName(firstName, lastName);
        return person;
    }
}
</code></pre>

<h2 id="the-default-repository">The default repository</h2>

<p>As we don&rsquo;t want to write unnecessary code, we will use a default repository implementation of SeedStack.</p>

<p>To do that, just inject the parameterized <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;business.&amp;#8203;domain.&amp;#8203;Repository' href='http://seedstack.org/javadoc/org/seedstack/business/domain/Repository.html'>Repository</a></code> interface in your
<code>HelloResource</code>. We will combine it with the service we defined <a href="http://seedstack.org/docs/basics/business/#the-greeter-service">before</a>:</p>

<pre><code class="language-java">package org.generated.project.interfaces.rest;

import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.NotFoundException;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import org.generated.project.domain.model.person.Person;
import org.generated.project.domain.model.person.PersonId;
import org.generated.project.domain.services.GreeterService;
import org.seedstack.business.domain.Repository;
import org.seedstack.business.util.inmemory.InMemory;

@Path(&quot;hello&quot;)
public class HelloResource {
    @Inject
    @InMemory
    private Repository&lt;Person, PersonId&gt; personRepository;
    @Inject
    private GreeterService greeterService;

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return personRepository.get(new PersonId(&quot;bill.evans@some.org&quot;))
                .map(greeterService::greet)
                .orElseThrow(NotFoundException::new);
    }
}
</code></pre>

<div class="callout callout-info">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
            
                <i class="fa fa-info-circle icon-2x" style="line-height: 30px;"></i>
            
            
            
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>Multiple repository implementations can co-exist, so we need to choose one by qualifying the injection point. An <strong>in-memory</strong>
implementation is enough for now, so we use the <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;business.&amp;#8203;util.&amp;#8203;inmemory.&amp;#8203;InMemory' href='http://seedstack.org/javadoc/org/seedstack/business/util/inmemory/InMemory.html'>@InMemory</a></code>
qualifier.</p>

        </div>
    </div>
</div>

<h2 id="custom-query">Custom query</h2>

<p>As business needs evolve, you will surely need to implement custom queries to retrieve aggregates.</p>

<p>With SeedStack, you can build <strong>custom queries on the object model</strong>, regardless of the persistence implementation. This
is done in a custom repository interface, with a <a href="http://seedstack.org/docs/business/specifications/">specification</a>.</p>

<p>In the <code>domain.model.person</code> package, create the <code>PersonRepository</code> interface, extending <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;business.&amp;#8203;domain.&amp;#8203;Repository' href='http://seedstack.org/javadoc/org/seedstack/business/domain/Repository.html'>Repository</a></code> :</p>

<pre><code class="language-java">package org.generated.project.domain.model.person;

import java.util.stream.Stream;
import org.seedstack.business.domain.Repository;

public interface PersonRepository extends Repository&lt;Person, PersonId&gt; {
    default Stream&lt;Person&gt; findByName(String name) {
        return get(getSpecificationBuilder().of(Person.class)
                .property(&quot;firstName&quot;).matching(name).ignoringCase()
                .or()
                .property(&quot;lastName&quot;).matching(name).ignoringCase()
                .build()
        );
    }
}
</code></pre>

<p>We can now inject this custom interface in the <code>HelloResource</code> class instead of the default repository:</p>

<pre><code class="language-java">package org.generated.project.interfaces.rest;

import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.NotFoundException;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import org.generated.project.domain.model.person.PersonRepository;
import org.generated.project.domain.services.GreeterService;
import org.seedstack.business.util.inmemory.InMemory;

@Path(&quot;hello&quot;)
public class HelloResource {
    @Inject
    @InMemory
    private PersonRepository personRepository;
    @Inject
    private GreeterService greeterService;

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public String hello() {
        return personRepository.findByName(&quot;ella&quot;)
                .findFirst()
                .map(greeterService::greet)
                .orElseThrow(NotFoundException::new);
    }
}
</code></pre>

<div class="callout callout-warning">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
            
            
                <i class="fa fa-exclamation-triangle icon-2x"></i>
            
            
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>For now, hot-reloading (with <code>seedstack:watch</code>) doesn&rsquo;t play well with the dynamic implementation generated for
a repository without explicit implementation.</p>

<p>If you wish to make changes to the <code>PersonRepository</code>, you&rsquo;ll have to restart the watch process manually.</p>

        </div>
    </div>
</div>

<h2 id="switch-to-jpa-persistence">Switch to JPA persistence</h2>

<p>To demonstrate that, with the code above, we have true independence from database technology, let&rsquo;s switch to a JPA
based persistence layer.</p>

<div class="callout callout-warning">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
            
            
                <i class="fa fa-exclamation-triangle icon-2x"></i>
            
            
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>As we will add new dependencies and some configuration, <strong>the application must be stopped</strong>.</p>

        </div>
    </div>
</div>

<h3 id="dependencies">Dependencies</h3>

<p>Add the SeedStack <a href="http://seedstack.org/addons/jpa/%">JPA add-on</a>:</p>








    
        
            
        
    

<div class="tab-v2">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#tab-org-seedstack-addons-jpa-jpa-maven" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/maven.png">Maven</a></li>
        <li class=""><a href="#tab-org-seedstack-addons-jpa-jpa-gradle" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/gradle.png">Gradle</a></li>
    </ul>
    <div class="clear-both"></div>
    <div class="tab-content" style="padding-top: 0;">
        <div class="tab-pane in active" id="tab-org-seedstack-addons-jpa-jpa-maven">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-xml no-linenums" style="background-color: #fff;">&lt;dependency&gt;
    &lt;groupId&gt;org.seedstack.addons.jpa&lt;/groupId&gt;
    &lt;artifactId&gt;jpa&lt;/artifactId&gt;<span id="org-seedstack-addons-jpa-jpa-version" style="display: none;">
    &lt;version&gt;4.2.0&lt;/version&gt;</span>
&lt;/dependency&gt;</code></pre>
            <small class="pull-right" style="color: #aaa; margin-top: -20px; margin-right: 5px;">
                <span id="org-seedstack-addons-jpa-jpa-warn" style="display: none;"><i class="fa fa-warning" style="color: orange;"></i> Specifying versions manually is error-prone, use <a href="http://seedstack.org/docs/basics#dependency-management">dependency management</a> instead.</span>
                <a style="cursor: pointer; display: block;" id="org-seedstack-addons-jpa-jpa-show" onclick="$('#org-seedstack-addons-jpa-jpa-version, #org-seedstack-addons-jpa-jpa-warn').show(); $('#org-seedstack-addons-jpa-jpa-show').hide();">Show version</a>
            </small>
        </div>
        <div class="tab-pane in" id="tab-org-seedstack-addons-jpa-jpa-gradle">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-gradle no-linenums" style="background-color: #fff;">dependencies {
    compile(&quot;org.seedstack.addons.jpa:jpa:4.2.0&quot;)
}</code></pre>
        </div>
    </div>
</div>


<p>Then add an implementation of the JPA standard like <a href="http://hibernate.org/">Hibernate</a>:</p>








    

<div class="tab-v2">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#tab-org-hibernate-hibernate-entitymanager-maven" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/maven.png">Maven</a></li>
        <li class=""><a href="#tab-org-hibernate-hibernate-entitymanager-gradle" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/gradle.png">Gradle</a></li>
    </ul>
    <div class="clear-both"></div>
    <div class="tab-content" style="padding-top: 0;">
        <div class="tab-pane in active" id="tab-org-hibernate-hibernate-entitymanager-maven">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-xml no-linenums" style="background-color: #fff;">&lt;dependency&gt;
    &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
    &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;<span id="org-hibernate-hibernate-entitymanager-version" >
    &lt;version&gt;5.3.7.Final&lt;/version&gt;</span>
&lt;/dependency&gt;</code></pre>
            <small class="pull-right" style="color: #aaa; margin-top: -20px; margin-right: 5px;">
                <span id="org-hibernate-hibernate-entitymanager-warn" style="display: none;"><i class="fa fa-warning" style="color: orange;"></i> Specifying versions manually is error-prone, use <a href="http://seedstack.org/docs/basics#dependency-management">dependency management</a> instead.</span>
                <a style="cursor: pointer; display: none;" id="org-hibernate-hibernate-entitymanager-show" onclick="$('#org-hibernate-hibernate-entitymanager-version, #org-hibernate-hibernate-entitymanager-warn').show(); $('#org-hibernate-hibernate-entitymanager-show').hide();">Show version</a>
            </small>
        </div>
        <div class="tab-pane in" id="tab-org-hibernate-hibernate-entitymanager-gradle">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-gradle no-linenums" style="background-color: #fff;">dependencies {
    compile(&quot;org.hibernate:hibernate-entitymanager:5.3.7.Final&quot;)
}</code></pre>
        </div>
    </div>
</div>


<p>Hibernate requires the following dependency if you&rsquo;re using Java 9 or more recent:</p>








    

<div class="tab-v2">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#tab-javax-xml-bind-jaxb-api-maven" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/maven.png">Maven</a></li>
        <li class=""><a href="#tab-javax-xml-bind-jaxb-api-gradle" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/gradle.png">Gradle</a></li>
    </ul>
    <div class="clear-both"></div>
    <div class="tab-content" style="padding-top: 0;">
        <div class="tab-pane in active" id="tab-javax-xml-bind-jaxb-api-maven">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-xml no-linenums" style="background-color: #fff;">&lt;dependency&gt;
    &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;<span id="javax-xml-bind-jaxb-api-version" >
    &lt;version&gt;2.3.0&lt;/version&gt;</span>
&lt;/dependency&gt;</code></pre>
            <small class="pull-right" style="color: #aaa; margin-top: -20px; margin-right: 5px;">
                <span id="javax-xml-bind-jaxb-api-warn" style="display: none;"><i class="fa fa-warning" style="color: orange;"></i> Specifying versions manually is error-prone, use <a href="http://seedstack.org/docs/basics#dependency-management">dependency management</a> instead.</span>
                <a style="cursor: pointer; display: none;" id="javax-xml-bind-jaxb-api-show" onclick="$('#javax-xml-bind-jaxb-api-version, #javax-xml-bind-jaxb-api-warn').show(); $('#javax-xml-bind-jaxb-api-show').hide();">Show version</a>
            </small>
        </div>
        <div class="tab-pane in" id="tab-javax-xml-bind-jaxb-api-gradle">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-gradle no-linenums" style="background-color: #fff;">dependencies {
    compile(&quot;javax.xml.bind:jaxb-api:2.3.0&quot;)
}</code></pre>
        </div>
    </div>
</div>


<p>Then add an in-memory capable database like <a href="http://hsqldb.org/">HyperSQL</a>:</p>








    

<div class="tab-v2">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#tab-org-hsqldb-hsqldb-maven" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/maven.png">Maven</a></li>
        <li class=""><a href="#tab-org-hsqldb-hsqldb-gradle" data-toggle="tab" aria-expanded="true"><img class="pull-left" style="margin: 0 5px 0 0; height: 20px;" src="http://seedstack.org//img/logos/gradle.png">Gradle</a></li>
    </ul>
    <div class="clear-both"></div>
    <div class="tab-content" style="padding-top: 0;">
        <div class="tab-pane in active" id="tab-org-hsqldb-hsqldb-maven">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-xml no-linenums" style="background-color: #fff;">&lt;dependency&gt;
    &lt;groupId&gt;org.hsqldb&lt;/groupId&gt;
    &lt;artifactId&gt;hsqldb&lt;/artifactId&gt;<span id="org-hsqldb-hsqldb-version" >
    &lt;version&gt;2.4.1&lt;/version&gt;</span>
&lt;/dependency&gt;</code></pre>
            <small class="pull-right" style="color: #aaa; margin-top: -20px; margin-right: 5px;">
                <span id="org-hsqldb-hsqldb-warn" style="display: none;"><i class="fa fa-warning" style="color: orange;"></i> Specifying versions manually is error-prone, use <a href="http://seedstack.org/docs/basics#dependency-management">dependency management</a> instead.</span>
                <a style="cursor: pointer; display: none;" id="org-hsqldb-hsqldb-show" onclick="$('#org-hsqldb-hsqldb-version, #org-hsqldb-hsqldb-warn').show(); $('#org-hsqldb-hsqldb-show').hide();">Show version</a>
            </small>
        </div>
        <div class="tab-pane in" id="tab-org-hsqldb-hsqldb-gradle">
            <pre style="margin-top: 0; border: solid 1px #eee; border-top: none;"><code class="language-gradle no-linenums" style="background-color: #fff;">dependencies {
    compile(&quot;org.hsqldb:hsqldb:2.4.1&quot;)
}</code></pre>
        </div>
    </div>
</div>


<div class="callout callout-tips">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
                <i class="fa fa-lightbulb-o icon-2x" style="line-height: 30px;"></i>
            
            
            
            
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>To connect to an external database, you would add its JDBC driver dependency instead.</p>

        </div>
    </div>
</div>

<h3 id="configure-a-database">Configure a database</h3>

<p>JPA is structured around the concept of <strong>&laquo;persistence units&raquo;</strong>. We have to configure at least one unit to use JPA and such unit needs
a JDBC datasource to work with. Add the following configuration in the <code>application.yaml</code> file:</p>

<pre><code class="language-yaml">jdbc:
  datasources:
    myDatasource:
      url: jdbc:hsqldb:mem:mydb
</code></pre>

<p>The configuration above will declare a JDBC datasource named <code>myDatasource</code> pointing to an auto-created, in-memory,
H2 database. Now declare a JPA unit using this datasource:</p>

<pre><code class="language-yaml">jpa:
  units:
    myUnit:
      datasource: myDatasource
      properties:
        hibernate.dialect: org.hibernate.dialect.HSQLDialect
        hibernate.hbm2ddl.auto: update
</code></pre>

<p>The configuration above will declare a JPA unit named <code>myUnit</code>, referencing our datasource.</p>

<div class="callout callout-info">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
            
                <i class="fa fa-info-circle icon-2x" style="line-height: 30px;"></i>
            
            
            
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>The properties are here to configure Hibernate, our JPA provider and are specific to it. Their role here is to tell
Hibernate what SQL dialect should be used and that we need the tables to be created or updated on startup.</p>

        </div>
    </div>
</div>

<h3 id="add-the-jpa-annotations">Add the JPA annotations</h3>

<p>JPA entities must be mapped to a relational model. While this can be done through XML mapping files, a simpler way is
to annotate the classes.</p>

<p>The PersonId class becomes:</p>

<pre><code class="language-java">package org.generated.project.domain.model.person;

import javax.persistence.Embeddable;
import org.seedstack.business.domain.BaseValueObject;

@Embeddable
public class PersonId extends BaseValueObject {
    private String email;

    private PersonId() {
        // needed for Hibernate
    }

    public PersonId(String email) {
        this.email = email;
    }

    // ...
}
</code></pre>

<p>The Person class becomes:</p>

<pre><code class="language-java">package org.generated.project.domain.model.person;
 
import javax.persistence.EmbeddedId;
import javax.persistence.Entity;
import org.seedstack.business.domain.BaseAggregateRoot;

@Entity
public class Person extends BaseAggregateRoot&lt;PersonId&gt; {
    @EmbeddedId
    private PersonId id;
    private String firstName;
    private String lastName;

    private Person() {
        // needed for Hibernate
    }
 
    public Person(PersonId id) {
        this.id = id;
    }
 
    // ...
}
</code></pre>

<div class="callout callout-info">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
            
                <i class="fa fa-info-circle icon-2x" style="line-height: 30px;"></i>
            
            
            
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>Note that we also added a private no-arg constructor to allow Hibernate to instantiate the classes.</p>

        </div>
    </div>
</div>

<h3 id="change-the-qualifiers">Change the qualifiers</h3>

<p>Now just replace the <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;business.&amp;#8203;util.&amp;#8203;inmemory.&amp;#8203;InMemory' href='http://seedstack.org/javadoc/org/seedstack/business/util/inmemory/InMemory.html'>@InMemory</a></code> injection qualifier with
the <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;jpa.&amp;#8203;Jpa' href='http://seedstack.org/javadoc/org/seedstack/jpa/Jpa.html'>@Jpa</a></code> qualifier common from the JPA add-on. This will tell SeedStack to choose
a JPA-based implementation (also provided by the add-on) for injection instead of the in-memory one.</p>

<p>Let&rsquo;s start with the <code>SampleDataGenerator</code> qualifier:</p>

<pre><code class="language-java">public class SampleDataGenerator implements LifecycleListener {
    @Inject
    @InMemory
    private Repository&lt;Person, PersonId&gt; personRepository;
    
    // ...
}
</code></pre>

<p>Becomes:</p>

<pre><code class="language-java">public class SampleDataGenerator implements LifecycleListener {
    @Inject
    @Jpa
    private Repository&lt;Person, PersonId&gt; personRepository;
    
    // ...
}
</code></pre>

<p>Then the HelloResource class:</p>

<pre><code class="language-java">@Path(&quot;hello&quot;)
public class HelloResource {
    @Inject
    @InMemory
    private PersonRepository personRepository;
    
    // ...
}
</code></pre>

<p>Becomes:</p>

<pre><code class="language-java">@Path(&quot;hello&quot;)
public class HelloResource {
    @Inject
    @Jpa
    private PersonRepository personRepository;
    
    // ...
}
</code></pre>

<h3 id="declare-a-transaction">Declare a transaction</h3>

<p><strong>JPA database work should be done in a transaction.</strong> A good place to start and end a transaction would be on an application
service that orchestrates all the needed operations for a particular use-case. We don&rsquo;t have such a service in our little
tutorial, so we will put the transaction on the <code>hello()</code> method of our REST resource.</p>

<p>Two annotations are needed here:</p>

<ul>
<li>The <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;seed.&amp;#8203;transaction.&amp;#8203;Transactional' href='http://seedstack.org/javadoc/org/seedstack/seed/transaction/Transactional.html'>@Transactional</a></code> annotation to declare the transaction boundaries,</li>
<li>And the <code><a data-toggle="tooltip" data-html="true" title='org.&amp;#8203;seedstack.&amp;#8203;jpa.&amp;#8203;JpaUnit' href='http://seedstack.org/javadoc/org/seedstack/jpa/JpaUnit.html'>@JpaUnit</a></code> annotation to declare on which resource the transaction should be
done.</li>
</ul>

<p>In the <code>HelloResource</code> class:</p>

<pre><code class="language-java">@Path(&quot;hello&quot;)
public class HelloResource {
    // ...

    @GET
    @Produces(MediaType.TEXT_PLAIN)
    @Transactional
    @JpaUnit(&quot;myUnit&quot;)
    public String hello() {
        // ...
    }
}
</code></pre>

<p>And in the <code>SampleDataGenerator</code> class:</p>

<pre><code class="language-java">public class SampleDataGenerator implements LifecycleListener {
    /// ...
 
    @Override
    @Transactional
    @JpaUnit(&quot;myUnit&quot;)
    public void started() {
        // ...
    }
    
    // ...
}
</code></pre>

<h3 id="run-the-application-again">Run the application again</h3>

<p>Startup the application again by issuing the following command:</p>

<pre><code class="language-bash">mvn seedstack:watch
</code></pre>

<p>You can now see that the <code>/hello</code> REST endpoint shows the same behavior as before but backed by JPA persistence. <strong>You
can see the JPA subsystem being initialized in the application startup logs.</strong></p>

<h3 id="what-happened">What happened ?</h3>

<p>Business-framework compatible persistence add-ons (like <a href="http://seedstack.org/addons/jpa/">JPA</a> or <a href="http://seedstack.org/addons/mongodb/">MongoDB</a>)
each provide:</p>

<ul>
<li>An implementation for all standard operations for repositories.</li>
<li>The ability to translate a domain specification into the corresponding technology-specific query.</li>
</ul>

<p>Both are used here, behind the scenes. The specification used in the <code>findByName()</code> method gets translated into a JPA
criteria query, turned then by Hibernate into the proper SQL query. <strong>The results are available as a <code><a data-toggle="tooltip" data-html="true" title='java.&amp;#8203;util.&amp;#8203;stream.&amp;#8203;Stream' href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html'>Stream</a></code>
of domain objects, loaded dynamically from the database as they are consumed.</strong></p>

<h2 id="now-what">Now what ?</h2>

<h3 id="what-we-learned">What we learned</h3>

<p>In this page you have learned:</p>

<ul>
<li>How to execute code at application startup, here to create sample data,</li>
<li>How to use the default repository implementation without writing any code,</li>
<li>How to write a technology-agnostic custom query with a specification,</li>
<li>How to configure and use an in-memory database with JPA and hibernate.</li>
</ul>

<div class="callout callout-ref">
    <div style="display:table; width: 100%">
        <div style="display:table-cell; width: 50px; vertical-align: middle;">
            
            
            
            
            
                <i class="fa fa-hand-o-right icon-2x"></i>
            
            
        </div>
        <div style="display:table-cell; vertical-align: middle;">
            <p>If you want to go further on the topic of persistence, see what you can read about <a href="http://seedstack.org/docs/business/repositories/">repositories</a>
and <a href="http://seedstack.org/docs/business/specifications/">specifications</a>.</p>

<p>You can also explore SeedStack <a href="http://seedstack.org/addons">persistence add-ons</a> documentation: <a href="http://seedstack.org/addons/jdbc/">JDBC</a>,
<a href="http://seedstack.org/addons/jpa/">JPA</a>, <a href="http://seedstack.org/addons/mongodb/">MongoDB</a>, etc&hellip;</p>

        </div>
    </div>
</div>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>If you can&rsquo;t get this to work, check the <a href="http://seedstack.org/docs/troubleshooting/">troubleshooting page</a>.</p>

<h3 id="next-step">Next step</h3>

<p>If you want to learn more, continue on the tutorial on <a href="http://seedstack.org/docs/basics/rest/">REST API</a>.</p>

            </div>
        </div>
    </div>
</div>

    </div>
    <div id="toc">
        <div class="toc" data-spy="affix" data-offset-top="314" data-offset-bottom="336">
    <div>
        
        <div>
            
            <a href='/docs/basics/business/' class="dib f6 pr1 hover-bg-light-gray br-100" data-toggle="tooltip" title='Business code'>
                <i class="fa fa-chevron-left"></i>
            </a>
            
            &nbsp;&nbsp;&nbsp;
            
            <a href='/docs/basics/rest/' class="dib f6 pl1 hover-bg-light-gray br-100" data-toggle="tooltip" title='REST API'>
                <i class="fa fa-chevron-right"></i>
            </a>
            
        </div>
        
    </div>
    <br/>
    <div>
        <p class="title">On this page</p>
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#we-need-some-data-first">We need some data first!</a></li>
<li><a href="#the-default-repository">The default repository</a></li>
<li><a href="#custom-query">Custom query</a></li>
<li><a href="#switch-to-jpa-persistence">Switch to JPA persistence</a>
<ul>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#configure-a-database">Configure a database</a></li>
<li><a href="#add-the-jpa-annotations">Add the JPA annotations</a></li>
<li><a href="#change-the-qualifiers">Change the qualifiers</a></li>
<li><a href="#declare-a-transaction">Declare a transaction</a></li>
<li><a href="#run-the-application-again">Run the application again</a></li>
<li><a href="#what-happened">What happened ?</a></li>
</ul></li>
<li><a href="#now-what">Now what ?</a>
<ul>
<li><a href="#what-we-learned">What we learned</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#next-step">Next step</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
    <br/>
    <div>
        
        
        <a href="https://github.com/seedstack/website/edit/master/content/docs/basics/persistence.md" target="_blank"><i class="fa fa-edit"></i> Edit</a>
        
    </div>
</div>
    </div>
    <div id="footer">
        <a class="scrollup">Scroll</a>
<div class="footer-v3">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 md-margin-bottom-40">
                    <div class="headline"><h2>About</h2></div>
                    <p class="margin-bottom-25 md-margin-bottom-40">
                        SeedStack is an opinionated, easy-to-use Java development stack for building applications and micro-services.
                    </p>
                    <p>
                        <i class="fa fa-file-text"></i> <a target="_blank" href="http://seedstack.org/docs">Docs</a>
                        <i class="fa fa-info-circle"></i> <a target="_blank" href="http://seedstack.org/javadoc">Javadoc</a>
                        <i class="fa fa-book"></i> <a target="_blank" href="http://seedstack.org/guides">Guides</a>
                        <i class="fa fa-plug"></i> <a target="_blank" href="http://seedstack.org/addons">Add-ons</a>
                        <br/>
                        <i class="fa fa-keyboard-o"></i> <a style="cursor: pointer;" onclick="seedstack.ui.openHelp();">Keyboard shortcuts</a>
                    </p>
                </div>

                <div class="col-md-4 md-margin-bottom-40">
                    <div class="posts">
                        <div class="headline"><h2>License and credits</h2></div>
                        <p>
                            Code licensed under the <a href="https://www.mozilla.org/MPL/2.0" target="_blank">Mozilla Public License 2.0</a>.
                            <br/>
                            Documentation licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.
                            <br/>
                            Some illustrations by <a href="https://www.Vecteezy.com/">www.Vecteezy.com</a>
                        </p>
                    </div>
                </div>

                <div class="col-md-4 map-img">
                    <div class="headline"><h2>Contact us</h2></div>
                    <address>
                        <p>
                            <i class="fa fa-stack-overflow"></i> <a target="_blank" href="http://stackoverflow.com/questions/ask?tags=seedstack">StackOverflow</a>
                            <br/>
                            <i class="fa fa-comments"></i> <a target="_blank" href="https://kiwiirc.com/client/irc.freenode.net#seedstack">IRC</a>
                            <br/>
                            <i class="fa fa-github"></i> <a target="_blank" href="https://github.com/seedstack">GitHub</a>
                            <br/>
                            <i class="fa fa-link"></i> <a target="_blank" href="https://projects.ow2.org/bin/view/seedstack/">OW2</a>
                        </p>
                    </address>

                    <div class="headline"><h2>Stay in touch</h2></div>
                    <div style="margin-bottom: 20px;">
                        <a class="twitter-follow-button"
                           href="https://twitter.com/seedstack"
                           data-show-count="false"
                           data-size="large"
                           data-lang="en">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    </div>
    <div id="hotkeys-modal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Keyboard shortcuts</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <table class="keyboard-mappings">
                            <tbody>
                            <tr>
                                <td class="keys">
                                    <kbd>?</kbd>
                                </td>
                                <td>Show this help dialog</td>
                            </tr>
                            <tr>
                                <td class="keys">
                                    <kbd>/</kbd>
                                </td>
                                <td>Focus the search field</td>
                            </tr>
                            <tr style="height: 20px;"><td></td></tr>
                            <tr>
                                <td class="keys">
                                    <kbd><i class="fa fa-arrow-left"></i></kbd>
                                </td>
                                <td>Go to previous page</td>
                            </tr>
                            <tr>
                                <td class="keys">
                                    <kbd><i class="fa fa-arrow-right"></i></kbd>
                                </td>
                                <td>Go to next page</td>
                            </tr>
                            <tr style="height: 20px;"><td></td></tr>
                            <tr>
                                <td class="keys">
                                    <kbd>g</kbd> <kbd>d</kbd>
                                </td>
                                <td>Go to documentation</td>
                            </tr>
                            <tr>
                                <td class="keys">
                                    <kbd>g</kbd> <kbd>a</kbd>
                                </td>
                                <td>Go to add-ons library</td>
                            </tr>
                            <tr>
                                <td class="keys">
                                    <kbd>g</kbd> <kbd>g</kbd>
                                </td>
                                <td>Go to guides list</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="versions-modal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 id="versions-title" class="modal-title">Fetching components...</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <table id="versions-table" class="table table-striped table-hover table-bordered">
                            <tr>
                                <th>Component</th>
                                <th>Version</th>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/idea.min.css">

    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/gradle.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.1.0/highlightjs-line-numbers.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mousetrap/1.4.6/mousetrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
<script src="/js/jquery.highlight.js"></script>
<script src="/js/seedstack.js"></script>
<script>
    $(document).ready(function () {
        var $search = $('.search-btn');

        $('.search').click(function () {
            if ($search.hasClass('fa-search')) {
                seedstack.ui.openSearch();
            } else {
                seedstack.ui.closeSearch();
            }
        });

        function hideJavaImports(block) {
            $(block).filter('.language-java')
                .find('table > tbody > tr')
                .each(function (i, javaLine) {
                    var $javaLine = $(javaLine);
                    var code = $javaLine.find("td.hljs-ln-code div.hljs-ln-line").text();
                    if (/^package/.test(code) || /^import/.test(code) || code.trim().length === 0) {
                        $javaLine.hide();
                    } else {
                        return false;
                    }
                });
        }

        $('pre code').each(function (i, block) {
            hljs.highlightBlock(block);

            if ($(block).not('.no-linenums').length > 0) {
                hljs.lineNumbersBlock(block);
                
                var lastLine = $(block).find('table > tbody > tr:last');
                if (lastLine.text().trim() === "") {
                    lastLine.remove();
                }
            }

            
            hideJavaImports(block);
        });

        
        $('.doc-content h2, .doc-content h3').each(function () {
            $(this).append(" <a class='title-anchor' href='#" + this.id + "'>#</a>");
        });

        Mousetrap.bind('/', function () {
            seedstack.ui.openSearch();
            return false;
        });

        Mousetrap.bind('left', function () {
            if (seedstack.state.previousPage) {
                window.location = seedstack.state.previousPage;
            }
            return false;
        });

        Mousetrap.bind('right', function () {
            if (seedstack.state.nextPage) {
                window.location = seedstack.state.nextPage;
            }
            return false;
        });

        Mousetrap.bind('?', function () {
            seedstack.ui.openHelp();
            return false;
        });

        Mousetrap.bind('esc', function () {
            seedstack.ui.closeHelp();
            seedstack.ui.closeSearch();
            seedstack.ui.closeVersions();
            return false;
        });

        var originalCallback = Mousetrap.stopCallback;
        Mousetrap.stopCallback = function (e, element, combo) {
            if (combo === 'esc') {
                return false;
            }

            return originalCallback(e, element, combo);
        };

        function bindShortcuts(value) {
            $.each(value, function (sequence, item) {
                if (typeof item === 'string') {
                    Mousetrap.bind("g " + sequence, function () {
                        window.location = item;
                        return false;
                    });
                } else if (typeof item === 'object') {
                    Mousetrap.bind("g " + sequence, function () {
                        window.location = item.path;
                        return false;
                    });
                    if (item.shortcuts && location.pathname.indexOf(item.path) === 0) {
                        bindShortcuts(item.shortcuts);
                    }
                }
            });
        }

        bindShortcuts(seedstack.ui.shortcuts);

        $('.quick-paste span').each(function (index, element) {
            $(element).attr({"id": "quick-paste-line"});
            $(element).append("<span data-toggle=\"tooltip\" data-placement=\"top\" data-title=\"Copy\" data-clipboard-target=\"#quick-paste-line\" class=\"copy-button\"><i class=\"fa fa-clipboard\"></i></span>");
        });
        var preId = 0;
        $('.doc-content pre').each(function (index, element) {
            preId++;
            $(element).attr({"id": "snippet-" + preId});
            $(element).prepend("<span data-toggle=\"tooltip\" data-placement=\"left\" data-title=\"Copy\" data-clipboard-target=\"#snippet-" + preId + "\" class=\"copy-button\"><i class=\"fa fa-clipboard\"></i></span>");
        });
        var clipboard = new Clipboard('.copy-button', {
            target: function (trigger) {
                var elt = $($(trigger).data('clipboard-target'));
                elt.find('code > table > tbody > tr').show();
                return elt.get(0);
            }
        });
        clipboard.on('success', function (e) {
            var elt = $($(e.trigger).data('clipboard-target'));
            hideJavaImports($(elt).children("code"));

            var tooltip = $("body #" + $(e.trigger).attr("aria-describedby"));
            tooltip.css('left', '-=14px');
            tooltip.children(".tooltip-inner").html("Copied!");
            e.clearSelection();
        });
        clipboard.on('error', function (e) {
            var tooltip = $("body #" + $(e.trigger).attr("aria-describedby"));
            tooltip.css('left', '-=83px');
            tooltip.children(".tooltip-inner").html("Error! Copy manually");
        });

        $('[data-toggle="tooltip"]').tooltip({
            container: 'body'
        });

        $('#hotkeys-modal, #versions-modal').bind('hidden.bs.modal', function () {
            $("html").css("margin-right", "0px");
        }).bind('show.bs.modal', function () {
            $("html").css("margin-right", "-15px");
        });

        var query = seedstack.strings.parseQueryString(location);
        if (query.h && query.h.length > 0) {
            $('.doc-content').highlight(query.h);
            if (query.scroll) {
                var firstOccurence = $('span[class=highlight]:first');
                if (firstOccurence.length > 0) {
                    $('html, body').animate({
                        scrollTop: firstOccurence.offset().top - 20
                    }, 250);
                }
            }
        }

        $(window).scroll(function () {
            if ($(this).scrollTop() > 200) {
                $('.scrollup').fadeIn();
            } else {
                $('.scrollup').fadeOut();
            }
        });

        $('.scrollup').click(function () {
            $("html, body").animate({scrollTop: 0}, 250);
            return false;
        });
    });
</script>
<script>window.twttr = (function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);
    t._e = [];
    t.ready = function (f) {
        t._e.push(f);
    };
    return t;
}(document, "script", "twitter-wjs"));</script>

</body>
</html>